var image_added;!function(t){var e,i,n,s,o,a;t(document).ready(function(){var i=t("#page_image_picker");a=i.data("input-type"),o="wym"==a,t("#custom_images_tab a").click(function(){if(!i.data("size-applied")&&o){var e=t(".page_part:first .wym_box"),n=t(".page_part:first iframe");i.css({height:e.height(),width:e.width()}).data("size-applied",!0).corner("tr 5px").corner("bottom 5px").find(".wym_box").css({backgroundColor:"white",height:n.height()+t(".page_part:first .wym_area_top").height()-parseInt(t(".wym_area_top .label_inline_with_link a").css("lineHeight")),width:n.width()-20,"border-color":n.css("border-top-color"),"border-style":n.css("border-top-style"),"border-width":n.css("border-top-width"),padding:"0px 10px 0px 10px"})}}),t("#page_images li textarea:hidden").each(function(e){var i=t(this).attr("name"),n=t(this);n.attr("data-old-id",n.attr("id")),n.attr("name","ignore_me_"+e),n.attr("id","ignore_me_"+e);var s=t("<input>").addClass("caption").attr("type","hidden").attr("name",i).attr("id",n.attr("data-old-id")).val(n.val());n.parents("li").first().append(s)}),e(),t(".page-images-caption-modal").hide(),s=t("#page_images .js-page-images-template").detach()}),e=function(){o&&WYMeditor.onload_functions.push(function(){t(".wym_box").css({width:null})}),t("#page_images").sortable({tolerance:"pointer",placeholder:"placeholder",cursor:"drag",items:"li",stop:n}),t("#page_images").on("mouseenter mouseleave","li",function(e){var s=t(this),o=s.find(".image_actions");if("mouseenter"==e.type){if(0==o.length){o=t("<div class='image_actions'></div>");var a=t("<img src='/assets/refinery/icons/delete.png' width='16' height='16' />");if(a.appendTo(o),a.click(function(){t(this).parents("li").first().remove(),n()}),s.find("textarea.page_caption").length>0){var r=t("<img src='/assets/refinery/icons/user_comment.png' width='16' height='16' class='caption' />");r.appendTo(o),r.click(i)}else o.addClass("no_captions");o.appendTo(s)}o.show()}else"mouseleave"==e.type&&o.hide()}),n()},image_added=function(i){var n=s.clone(),o=t(i).attr("id").replace("image_","");n.find("input:hidden:first").val(o),t("<img />").attr({title:t(i).attr("title"),alt:t(i).attr("alt"),src:t(i).attr("data-grid")}).appendTo(n),n.attr("id","image_"+o).removeClass("empty"),n.appendTo(t("#page_images")),e()},i=function(){var e=t(this).closest("li"),i=e.find(".page-images-caption-modal > textarea"),n=i.parent(),s={textarea:{width:400,height:"auto"},wym:{width:928,height:530}};n.find(".js-page-images-done").on("click",function(){n.dialog("close")});var r=function(){o&&i.data("wymeditor").update(),t("li.current_caption_list_item").removeClass("current_caption_list_item"),t("#"+i.attr("data-old-id")).val(i.val()),n.dialog("destroy")};e.addClass("current_caption_list_item"),n.dialog({title:"Add Caption",modal:!0,resizable:!1,autoOpen:!0,width:s[a].width,height:s[a].height,close:r}),o?i.addClass("wymeditor active_rotator_wymeditor widest").wymeditor(wymeditor_boot_options):i.show()},n=function(){t("#page_images li textarea:hidden").each(function(e,i){var n=t(i).attr("name").split("_");n[2]=""+e,t(i).attr("name",n.join("_")),t(i).attr("id",t(i).attr("id").replace(/_\d/,"_"+e)),t(i).attr("data-old-id",t(i).attr("data-old-id").replace(/_\d_/,"_"+e+"_").replace(/_\d/,"_"+e))}),t("#page_images li").each(function(e,i){t("input:hidden",i).each(function(){var i=t(this),n=i.attr("name").split("]");n[1]="["+e,i.attr("name",n.join("]")),i.attr("id",i.attr("id").replace(/_\d_/,"_"+e+"_").replace(/_\d/,"_"+e))})})}}(jQuery);